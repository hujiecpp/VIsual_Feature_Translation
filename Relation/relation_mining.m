clear;clc;
mean_D = zeros(16, 16);
mean_U = zeros(16, 16);
%% Holidays
% D
Ho_D = [ ...
0.00004016 0.16112835 0.38455757 0.38059205 0.39365301 0.37735879 0.30602518 0.38785723 0.47682840 0.51400489 0.59477532 0.50396389 0.49956948 0.47147053 0.52883146 0.54016439 ;
0.12637218 0.00005725 0.38379166 0.37741232 0.39425638 0.37289304 0.30648515 0.38557580 0.47389895 0.50636297 0.59639740 0.49883512 0.50030041 0.46680227 0.53476005 0.53587595 ;
0.35122018 0.37073364 0.00014827 0.30220079 0.16109490 0.27881619 0.06885355 0.00364377 0.42006797 0.50068903 0.58110350 0.47421604 0.46628472 0.39073607 0.51393452 0.51869644 ;
0.36222613 0.37836395 0.31686577 0.00001498 0.29652032 0.05034594 0.22556031 0.32191339 0.44824123 0.43666556 0.56768525 0.43794516 0.47284260 0.44395056 0.51735138 0.52479088 ;
0.38019802 0.39802881 0.17162700 0.29739094 0.00013378 0.30424726 0.05346745 0.18241300 0.44203874 0.50629586 0.56051391 0.50090653 0.46690595 0.43942103 0.52278956 0.52927370 ;
0.35570413 0.37226798 0.29104108 0.05127223 0.30193734 0.00007418 0.20438957 0.29597351 0.44451347 0.44404769 0.57554078 0.41135931 0.45699197 0.43336868 0.51605940 0.52383492 ;
0.36529251 0.38346966 0.10249010 0.28807071 0.06980760 0.26757869 0.00010398 0.11252451 0.42755067 0.49625146 0.56482363 0.46641031 0.44389880 0.41931331 0.51913406 0.52820309 ;
0.34912589 0.36842977 0.00370607 0.30461454 0.16794026 0.28175309 0.07591791 0.00027894 0.41955000 0.50101382 0.58434743 0.47405839 0.46864200 0.38946167 0.50527017 0.51235262 ;
0.39260733 0.40503088 0.38310936 0.37328225 0.37202272 0.37452570 0.30040324 0.38531923 0.00171373 0.40229809 0.31104136 0.39811283 0.22519557 0.06317376 0.52101156 0.52207385 ;
0.40710115 0.41545377 0.41075724 0.36853951 0.39612070 0.37397635 0.33225384 0.42243311 0.40046573 0.00016243 0.49234822 0.07845985 0.41916135 0.41875011 0.51741544 0.52228648 ;
0.45448044 0.46329710 0.44411954 0.41908932 0.42145351 0.42794985 0.36131066 0.45178163 0.32189596 0.48684534 0.00161987 0.50468159 0.13732730 0.42332676 0.55545527 0.54946192 ;
0.40376831 0.40263768 0.40328050 0.36744079 0.39650401 0.35982054 0.31843951 0.40695277 0.39605609 0.07848392 0.50610590 0.00076357 0.39769861 0.40583679 0.51637258 0.52028037 ;
0.42503760 0.44049409 0.42083129 0.40643468 0.39854792 0.40283915 0.33088151 0.42176700 0.26195452 0.45479894 0.15045021 0.43610650 0.00152473 0.34654054 0.53829360 0.53962507 ;
0.38056790 0.39654382 0.36993116 0.36771613 0.36636698 0.36608320 0.29131052 0.37134361 0.05571789 0.40986940 0.39073846 0.39959568 0.28557277 0.00089215 0.50934391 0.51066971 ;
0.48869303 0.49694230 0.48629510 0.47235593 0.47476605 0.47111002 0.40204090 0.48614824 0.65121245 0.65425819 0.69978297 0.64935404 0.63761598 0.65085196 0.00001088 0.27259157 ;
0.49016396 0.50365506 0.48678225 0.47328591 0.47847369 0.47295392 0.40523314 0.48939863 0.65294951 0.65539128 0.70127106 0.65176982 0.63889706 0.65124547 0.26299321 0.00000855 ;
];
% U
U_row = Ho_D;
for i = 1 : 16
    U_row(i, :) = (U_row(i, :)-min(U_row(i,:))) / (max(U_row(i,:)) - min(U_row(i,:)));
end
U_col = Ho_D';
for i = 1 : 16
    U_col(i, :) = (U_col(i, :)-min(U_col(i,:))) / (max(U_col(i,:)) - min(U_col(i,:)));
end
Ho_U = (U_row + U_row' + U_col + U_col') / 4;

mean_D = mean_D + Ho_D;
mean_U = mean_U + Ho_U;
%% Oxford5k
% D
Ox_D = [ ...
0.00001982 0.17718754 0.38738763 0.38894540 0.39714545 0.38386682 0.31109700 0.38719401 0.47462261 0.52256185 0.59011316 0.51159650 0.48896796 0.45662397 0.52574542 0.53628247 ;
0.13932558 0.00007914 0.38592955 0.38482603 0.39854720 0.38105869 0.31243837 0.38666221 0.47462830 0.51712239 0.59352309 0.50555623 0.49364194 0.45637834 0.53080298 0.53187790 ;
0.34614673 0.36956623 0.00011761 0.31464511 0.15350488 0.28061152 0.04652112 0.00363312 0.42106795 0.51473916 0.56882900 0.47933671 0.44078648 0.39345309 0.52431707 0.52859344 ;
0.35837962 0.37588054 0.32463083 0.00006329 0.30269811 0.06130375 0.23983592 0.32917461 0.46226984 0.44442725 0.56762290 0.44648594 0.47226369 0.45188439 0.52366415 0.53088027 ;
0.37045385 0.39210257 0.16166133 0.30362323 0.00009233 0.30645472 0.06577200 0.17102753 0.44077879 0.52010143 0.54899603 0.50740182 0.45127252 0.43018106 0.52471281 0.53080806 ;
0.34815685 0.36725024 0.28890282 0.06218181 0.30432349 0.00008953 0.21054059 0.29144517 0.44985494 0.44961274 0.57153469 0.41407543 0.44927785 0.43174854 0.51911933 0.52694278 ;
0.35238083 0.37506959 0.06902315 0.29844433 0.08490778 0.26915690 0.00013951 0.07460322 0.42309195 0.50654584 0.55184865 0.46954563 0.42230707 0.40464222 0.52178164 0.53150868 ;
0.34406705 0.36530845 0.00367190 0.31569791 0.16013984 0.28057513 0.05014063 0.00016652 0.42094725 0.51499581 0.56997663 0.47664836 0.44146848 0.39067507 0.51701192 0.52358572 ;
0.37045526 0.39244939 0.37741604 0.38029844 0.36984685 0.37881500 0.29945639 0.37924132 0.00038669 0.42140743 0.30168304 0.40573803 0.20098722 0.05012240 0.52163153 0.52497232 ;
0.38925770 0.40436269 0.41010889 0.37215945 0.39972347 0.37568057 0.33868542 0.42036432 0.41394761 0.00071525 0.49897891 0.08949783 0.41980404 0.42025247 0.51908794 0.52625367 ;
0.42896210 0.44701001 0.43139961 0.41836306 0.41438764 0.42630321 0.35893700 0.43839398 0.30709243 0.49612415 0.00130560 0.50757170 0.15123415 0.38483384 0.54205412 0.53998872 ;
0.38703358 0.39311354 0.40107766 0.37251654 0.39812779 0.36159644 0.32176238 0.40230960 0.40286276 0.08990960 0.50949442 0.00038973 0.39239228 0.40062112 0.51724725 0.52295199 ;
0.40087712 0.42506756 0.40801433 0.40880033 0.39123234 0.40159410 0.32541403 0.40770018 0.23312777 0.46391177 0.16760188 0.43380839 0.00132673 0.29371035 0.52748088 0.53060417 ;
0.35998003 0.38297359 0.36492315 0.37592417 0.36552989 0.36995906 0.29047391 0.36720845 0.04821447 0.42737538 0.37317577 0.40506569 0.24767263 0.00011457 0.51342103 0.51741864 ;
0.49340008 0.50517965 0.50380486 0.49045822 0.49553370 0.48904181 0.43289891 0.50440687 0.67924166 0.68095791 0.71823615 0.66855371 0.65857404 0.66698873 0.00000737 0.33771707 ;
0.49530999 0.51032974 0.50457996 0.49213329 0.49690920 0.49094003 0.43605629 0.50717634 0.68150961 0.68054581 0.71973687 0.67079043 0.66077012 0.66779834 0.33429328 0.00010618 ;
];
% U
U_row = Ox_D;
for i = 1 : 16
    U_row(i, :) = (U_row(i, :)-min(U_row(i,:))) / (max(U_row(i,:)) - min(U_row(i,:)));
end
U_col = Ox_D';
for i = 1 : 16
    U_col(i, :) = (U_col(i, :)-min(U_col(i,:))) / (max(U_col(i,:)) - min(U_col(i,:)));
end
Ox_U = (U_row + U_row' + U_col + U_col') / 4;

mean_D = mean_D + Ox_D;
mean_U = mean_U + Ox_U;

%% Paris6k
% D
Pa_D = [ ...
0.00007025 0.16581138 0.37689063 0.37892833 0.38854820 0.37219775 0.29973409 0.37693128 0.46187431 0.50140160 0.58165580 0.48804605 0.47248453 0.44836944 0.52865241 0.53617630 ;
0.13023687 0.00003459 0.37669498 0.37602797 0.38902295 0.36856312 0.30053693 0.37624076 0.46067521 0.49399939 0.58596712 0.48195177 0.47539470 0.44761646 0.53207335 0.53155650 ;
0.33842788 0.35878650 0.00008022 0.30922940 0.15018076 0.27727017 0.04587109 0.00368919 0.42047226 0.50044918 0.56822371 0.46592060 0.43752399 0.40050966 0.53000681 0.53131049 ;
0.35386952 0.37268051 0.32107338 0.00006998 0.29916680 0.05751756 0.23253472 0.32441664 0.45559165 0.42965052 0.56023216 0.42836961 0.45740157 0.45260802 0.52903636 0.53285375 ;
0.36507331 0.38730877 0.15915692 0.30020839 0.00002773 0.30292079 0.06314842 0.16775353 0.44022050 0.50565559 0.54469419 0.49325880 0.44336334 0.43366835 0.52872744 0.53316567 ;
0.34073662 0.36009490 0.28545552 0.05857656 0.30033386 0.00009054 0.20471491 0.28831667 0.44556251 0.43351889 0.56606066 0.39957809 0.43804765 0.43495396 0.52441201 0.52842947 ;
0.34597283 0.36661514 0.06820619 0.29148754 0.08140369 0.26426828 0.00010780 0.07291038 0.42220071 0.48973227 0.55014676 0.45429823 0.41643843 0.41098291 0.52647665 0.53466328 ;
0.33554381 0.35543093 0.00365428 0.31053382 0.15625229 0.27673253 0.04921762 0.00015869 0.42043263 0.50016320 0.57068282 0.46327969 0.43674481 0.39822808 0.52273373 0.52627891 ;
0.36884363 0.38865219 0.38003102 0.37671316 0.36879024 0.37511507 0.29773620 0.38067999 0.00177733 0.40624326 0.30777252 0.39239231 0.19533312 0.04378105 0.52455271 0.52588678 ;
0.38772410 0.40020692 0.40634206 0.36660326 0.39461690 0.36882806 0.32972193 0.41565195 0.40353453 0.00249153 0.48676583 0.08249554 0.40077138 0.41776446 0.52145877 0.52638161 ;
0.43080725 0.45088101 0.42989355 0.41365069 0.41362754 0.42191243 0.35588452 0.43569875 0.31722376 0.48260492 0.00154934 0.49645728 0.15437511 0.39210418 0.54659210 0.54303351 ;
0.38445496 0.38740897 0.39759251 0.36508501 0.39294991 0.35500753 0.31443885 0.39807254 0.39235523 0.08352482 0.50038302 0.00081658 0.37755054 0.39675888 0.52035318 0.52423985 ;
0.39974636 0.42388755 0.40558219 0.40124762 0.38761067 0.39544860 0.32101607 0.40426883 0.23112336 0.44322568 0.16860799 0.41585565 0.00203587 0.28883460 0.53125530 0.53341834 ;
0.35910573 0.38081208 0.37051463 0.37334615 0.36470285 0.36872247 0.29001287 0.37091351 0.04429592 0.41595596 0.37740979 0.39303088 0.24604203 0.00019566 0.51649615 0.51862430 ;
0.49341823 0.50496193 0.49618658 0.48517552 0.49390706 0.48247328 0.42684728 0.49728629 0.67720032 0.66944498 0.71432287 0.65952247 0.65649855 0.66313237 0.00000394 0.32507289 ;
0.49360071 0.50981132 0.49714428 0.48468992 0.49424729 0.48268187 0.42855516 0.49972588 0.67857546 0.66884238 0.71540058 0.66052634 0.65890205 0.66416746 0.32193131 0.00005413 ;
];
% U
U_row = Pa_D;
for i = 1 : 16
    U_row(i, :) = (U_row(i, :)-min(U_row(i,:))) / (max(U_row(i,:)) - min(U_row(i,:)));
end
U_col = Pa_D';
for i = 1 : 16
    U_col(i, :) = (U_col(i, :)-min(U_col(i,:))) / (max(U_col(i,:)) - min(U_col(i,:)));
end
Pa_U = (U_row + U_row' + U_col + U_col') / 4;

mean_D = mean_D + Pa_D;
mean_U = mean_U + Pa_U;
%% Mean
mean_U = mean_U / 3;
mean_D = mean_D / 3;

% save('mean_D.mat', 'mean_D')
% save('mean_U.mat', 'mean_U')

%% Graph
features = {'DELF-FV','DELF-VLAD','R-CroW','R-GeM','R-MAC','R-rGeM','R-rMAC','R-SPoC','V-CroW','V-GeM','V-MAC','V-rGeM','V-rMAC','V-SPoC','SIFT-FV','SIFT-VLAD'};
%% Mean

x_label = {'DELF-FV','DELF-VLAD','R-CroW','R-GeM','R-MAC','R-rGeM','R-rMAC','R-SPoC','V-CroW','V-GeM','V-MAC','V-rGeM','V-rMAC','V-SPoC','SIFT-FV','SIFT-VLAD'};
y_label = {'DELF-FV','DELF-VLAD','R-CroW','R-GeM','R-MAC','R-rGeM','R-rMAC','R-SPoC','V-CroW','V-GeM','V-MAC','V-rGeM','V-rMAC','V-SPoC','SIFT-FV','SIFT-VLAD'};
figure;
h = heatmap(x_label, y_label, mean_U, ...
            'FontSize',12,'FontName','Times New Roman', 'CellLabelFormat','%0.2f');
% h.Title = 'The Directed Affinity Matrix U on Average';

x_label = {'DELF-FV','DELF-VLAD','R-CroW','R-GeM','R-MAC','R-rGeM','R-rMAC','R-SPoC','V-CroW','V-GeM','V-MAC','V-rGeM','V-rMAC','V-SPoC','SIFT-FV','SIFT-VLAD'};
y_label = {'DELF-FV','DELF-VLAD','R-CroW','R-GeM','R-MAC','R-rGeM','R-rMAC','R-SPoC','V-CroW','V-GeM','V-MAC','V-rGeM','V-rMAC','V-SPoC','SIFT-FV','SIFT-VLAD'};
figure;
h = heatmap(x_label, y_label, mean_D * 10, ...
            'FontSize',12,'FontName','Times New Roman', 'CellLabelFormat','%0.2f');
% h.Title = 'The Directed Affinity Matrix D on Average';

clc;
for i = 1 : 16
    for j = i + 1 : 16
        fprintf('{"source": "%s", "target": "%s", "dist": %.2f},\n', features{i}, features{j}, mean_U(i,j));
    end
end
% MST
fprintf('MST~~\n');
s = [];
t = [];
weights = [];
for i = 1 : 16
    for j = i + 1 : 16
        s = [s, i];
        t = [t, j];
        weights = [weights, mean_U(i, j)];
    end
end
G = graph(s,t,weights);
[T,pred] = minspantree(G);
for i = 1 : 15
    a = T.Edges.EndNodes(i, 1);
    b = T.Edges.EndNodes(i, 2);
    fprintf('{"source": "%s", "target": "%s", "dist": %.4f},\n', features{a}, features{b}, mean_U(a,b));
end
